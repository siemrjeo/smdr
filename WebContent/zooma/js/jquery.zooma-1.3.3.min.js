/**
 * ##########################################################################################
 * Image zoom (magnification) plugin for jQuery library http://alexeyenko.net/projects/zooma/
 *
 * Thanks to Justin Robert Wehrman (jwehrman@exertionist.com),
 * the developer of 'imageDetail' plugin http://exertionist.com/ImageDetail/
 *
 * Zooma jquery plugin page http://plugins.jquery.com/project/zooma
 *
 * Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
 * and GPL (http://www.opensource.org/licenses/gpl-license.php) licenses.
 *
 * v1.3.3 May       2011 - Fixed unbind - submitted patch from Justin Tanner
 * v1.3.2 January   2009 - Fixed deactivate method
 * v1.3.1 January   2009 - Added jQuery v 1.4 support
 * v1.3.0 January   2009 - Added ability to switch auto-hide off (added optional settings parameter), exitCallback function was added to settings
 * v1.2.3 December  2009 - Fixed viewfinder issues when zoom thumb is placed in absolutely positioned blocks. viewfinder element now must be placed in the root of html document
 * v1.2.2 November  2009 - Fixed exit if zoom viewfinder has same width/height as original image
 * v1.2.1 October   2009 - Added loading... indicator. Fixed bug when large image is smaller then zoom div.
 * v1.1.1 October   2009 - Viewfinder block alignment was updated.
 * v1.1.0 October   2009 - Added viewfinder box. Code refactor (code becomes Object oriented).
 * v1.0.1 October   2009 - Zoom becomes faster: better mouse events management.
 * v1.0.0 October   2009.
 * author: Ignat Alexeyenko, http://alexeyenko.net
 * ##########################################################################################
 */
(function(h){function n(){this.viewfinderBorderRight=this.viewfinderBorderBottom=this.viewfinderBorderLeft=this.viewfinderBorderTop=this.thumbImgOffsetBottom=this.thumbImgOffsetTop=this.thumbImgOffsetRight=this.thumbImgOffsetLeft=this.thumbImgPositionBottom=this.thumbImgPositionTop=this.thumbImgPositionRight=this.thumbImgPositionLeft=this.heightDiff=this.widthDiff=this.halfViewfinderHeight=this.halfViewfinderWidth=this.viewfinderHeight=this.viewfinderWidth=this.height=this.width=0;this.loaded=!1;
this.getHeight=function(){return this.height};this.getWidth=function(){return this.width};this.isLoaded=function(){return this.loaded}}function B(b,c){var g=new n,e=new Image;h(e).load(function(){g.width=e.width;g.height=e.height;g.loaded=!0;c(g)});h(e).attr("src",b);return g}function u(b,c,g,e){c+=e;if(b<c)return c;g-=e;if(b>g)return g;return b}function C(b){if(b==null||typeof b==void 0)b={};if(b.autoDeactivate==null||typeof b.autoDeactivate==void 0)b.autoDeactivate=!0;if(b.zoomViewfinder==null||
typeof b.zoomViewfinderName==void 0)b.zoomViewfinderName="zoomViewfinder";if(b.exitCallback==null||typeof b.exitCallback==void 0)b.exitCallback=function(){};return b}h.fn.zooma=function(b,c,g,e){function o(a){var b=a.pageX<p||a.pageX>v||a.pageY<q||a.pageY>w;if(D&&x&&b)h(document).unbind("mousemove",o),i.hide(),f.hide(),E();else if(!b&&d.isLoaded()){var b=a.pageY,c=d.viewfinderBorderTop+d.viewfinderBorderBottom,a=u(a.pageX,d.thumbImgOffsetLeft,d.thumbImgOffsetRight-(d.viewfinderBorderLeft+d.viewfinderBorderRight),
d.halfViewfinderWidth),b=u(b,d.thumbImgOffsetTop,d.thumbImgOffsetBottom-c,d.halfViewfinderHeight),c=Math.round(b-d.halfViewfinderHeight);f.css("left",Math.round(a-d.halfViewfinderWidth));f.css("top",c);var e=c=0,e=r?Math.round((n-d.getWidth())/2):Math.round((Math.round(a)-d.thumbImgOffsetLeft)*-d.widthDiff+F),c=s?Math.round((G-d.getHeight())/2):Math.round((Math.round(b)-d.thumbImgOffsetTop)*-d.heightDiff+H);i.css("backgroundPosition",e+"px "+c+"px")}}function y(){x=!0;t||(i.show(),f.show(),t=!0,h(document).bind("mousemove",
o))}h.extend(this,{deactivate:function(){i.hide();f.hide();h(document).unbind("mousemove",o);z.unbind("mouseover");f.unbind("mouseover")},activate:function(){h(i).css({backgroundImage:"url("+g+")",backgroundRepeat:"no-repeat",backgroundPosition:"50% 50%"});i.show();t=!1;z.bind("mouseover",y);f.bind("mouseover",y)}});var t=!1,b=h("#"+b),i=h("#"+c),z=b.find("a"),c=b.find("img"),j=c.width(),k=c.height(),A=i.find("div.zoomLoading"),l=i.width(),m=i.height(),n=i.width(),G=i.height(),F=l/2,H=m/2,I=c.position().left,
J=c.position().left+j,K=c.position().top,L=c.position().top+k,p=c.offset().left,v=c.offset().left+j,q=c.offset().top,w=c.offset().top+k,x=!1,r=!1,s=!1,e=C(e),D=e.autoDeactivate,E=e.exitCallback,f=h("#"+e.zoomViewfinderName),d=new B(g,function(a){a.viewfinderBorderTop=parseInt(f.css("borderTopWidth"));a.viewfinderBorderLeft=parseInt(f.css("borderLeftWidth"));a.viewfinderBorderBottom=parseInt(f.css("borderBottomWidth"));a.viewfinderBorderRight=parseInt(f.css("borderRightWidth"));if(a.getWidth()!=0&&
a.getHeight()!=0)l>a.getWidth()&&(l=a.getWidth(),r=!0),m>a.getHeight()&&(m=a.getHeight(),s=!0),a.viewfinderWidth=Math.round(j*l/a.getWidth()),a.viewfinderHeight=Math.round(k*m/a.getHeight()),r&&(a.viewfinderWidth-=a.viewfinderBorderLeft+a.viewfinderBorderRight),s&&(a.viewfinderHeight-=a.viewfinderBorderTop+a.viewfinderBorderBottom),a.halfViewfinderWidth=a.viewfinderWidth/2,a.halfViewfinderHeight=a.viewfinderHeight/2,a.widthDiff=a.getWidth()/j,a.heightDiff=a.getHeight()/k;a.thumbImgPositionLeft=I;
a.thumbImgPositionRight=J;a.thumbImgPositionTop=K;a.thumbImgPositionBottom=L;a.thumbImgOffsetLeft=p;a.thumbImgOffsetRight=v;a.thumbImgOffsetTop=q;a.thumbImgOffsetBottom=w;f.css("width",a.viewfinderWidth);f.css("height",a.viewfinderHeight);f.css("left",p+Math.round(j/2-(a.viewfinderWidth+a.viewfinderBorderLeft+a.viewfinderBorderRight)/2));f.css("top",q+Math.round(k/2-(a.viewfinderHeight+a.viewfinderBorderTop+a.viewfinderBorderBottom)/2));f.show();A.hide()});d.isLoaded()||A.show();return this}})(jQuery);
